---
title: "Blog Post 7"
author: "Yating Zhu, Dingyu Guo, Suh Edwin Jiho, Wang Muxi"
date: "2024-04-19"
date-modified: "2024-04-19"
draft: FALSE
---
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyr)
library(broom)
library(dplyr)
library(here)
library(gt)
library(purrr)
data_path <- here("dataset", "data_twenty_clean.csv")
data_path1 <- here("dataset", "latest_clean.csv")
library(readr)
data_twenty <- read_csv(data_path,show_col_types = FALSE) 
data_2022 <- read_csv(data_path1,show_col_types = FALSE) 
library(ggplot2)
library(knitr)
library(lme4)
library(broom.mixed)
```

# Time series model
```{r echo=FALSE, message=FALSE, warning=FALSE}
model <- lmer(RENTGRS ~ ROOMS + NFAMS + AGE + (1 | REGION), data = data_twenty, REML = FALSE)

model_with_income <- lmer(RENTGRS ~ ROOMS + NFAMS + AGE + INCTOT + (1 | REGION), data = data_twenty, REML = FALSE)
```

- Fit a time series model using data from 2000 to 2022. 
- 
## Summary table 
```{r}
model_glance <- broom.mixed::glance(model)

model_tidy <- broom.mixed::tidy(model)

model_augment <- broom.mixed::augment(model)
```

```{r}
print(model_glance)
print(model_tidy)
print(head(model_augment))
```
## Residual plot 
```{r}
plot(residuals(model))
```



data_twenty$fitted <- predict(model, re.form = NA)
yearly_trends <- data_twenty %>%
  group_by(YEAR) %>%
  summarise(Average_Fitted = mean(fitted))

ggplot(yearly_trends, aes(x = YEAR, y = Average_Fitted)) +
  geom_line() +
  labs(title = "Time Series Plot of Fitted Rent Values by Year",
       x = "Year",
       y = "Average Fitted Rent") +
  theme_minimal()
```
The linear mixed-effects model is used to understand how different factors (rooms, family size, and age) influence rent prices, with variations across different regions taken into account as random effects. The model's summary would give an insight into which factors are statistically significant and their estimated effects on rent prices. 

Moreover, the residual plot, which shows the residuals on the y-axis against the index of observations on the x-axis. The residuals appear to be randomly scattered around the horizontal axis at zero, with no clear patterns or trends. This suggests that the model does not exhibit obvious systematic bias. However, there are some points that stand out from the cloud of points, indicating potential outliers or anomalies in the data.

The time series plot of the fitted rent values by year. This plot visualizes the average rent price predicted by the model across different years: The plot shows fluctuations in the average fitted rent values over time, with an overall increasing trend until around 2015, after which there is a sharp decrease. The rise until 2015 could indicate increasing rent prices over time due to various factors such as inflation, market demand, or changes in the number of rooms, family size, and the age of the buildings. The sharp decline after 2015 could be due to an economic event, policy change, or other external factors not captured by the model.




