---
title: "Blog Post 7"
author: "Yating Zhu, Dingyu Guo, Suh Edwin Jiho, Wang Muxi"
date: "2024-04-19"
date-modified: "2024-04-19"
draft: FALSE
---
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyr)
library(broom)
library(dplyr)
library(here)
library(gt)
library(purrr)
data_path <- here("dataset", "data_twenty_clean.csv")
data_path1 <- here("dataset", "latest_clean.csv")
library(readr)
data_twenty <- read_csv(data_path,show_col_types = FALSE) 
data_2022 <- read_csv(data_path1,show_col_types = FALSE) 
library(ggplot2)
library(knitr)
library(lme4)
library(broom.mixed)
```

# Time series model
```{r echo=FALSE, message=FALSE, warning=FALSE}
model <- lmer(RENTGRS ~ ROOMS + NFAMS + AGE + (1 | REGION), data = data_twenty, REML = FALSE)

model_with_income <- lmer(RENTGRS ~ ROOMS + NFAMS + AGE + INCTOT + (1 | REGION), data = data_twenty, REML = FALSE)
```

- Fit a time series model using data from 2000 to 2022. 
- 
## Summary table 
```{r echo=FALSE, message=FALSE, warning=FALSE}
model_glance <- broom.mixed::glance(model)

model_tidy <- broom.mixed::tidy(model)

model_augment <- broom.mixed::augment(model)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
print(model_glance)
print(model_tidy)
print(head(model_augment))
```
## Residual plot 
```{r echo=FALSE, message=FALSE, warning=FALSE}
plot(residuals(model))
```


```{r echo=FALSE, message=FALSE, warning=FALSE}
data_twenty$fitted <- predict(model, re.form = NA)
yearly_trends <- data_twenty %>%
  group_by(YEAR) %>%
  summarise(Average_Fitted = mean(fitted))

ggplot(yearly_trends, aes(x = YEAR, y = Average_Fitted)) +
  geom_line() +
  labs(title = "Time Series Plot of Fitted Rent Values by Year",
       x = "Year",
       y = "Average Fitted Rent") +
  theme_minimal()
```

- The linear mixed-effects model assesses the impact of rooms, family size, and age on rent prices.
- Random effects account for region-based variations.
- The model summary indicates the significance and impact of each factor on rent prices.
- The residual plot reveals:
  1) Residuals are widely dispersed around zero, suggesting no systematic bias in the model.
  2) Some outliers are present, which could be anomalies.
- The time series plot of fitted values shows:
  1) Fluctuating average fitted rent values over the years.
  2) An increasing trend in rent prices up to 2015.
  3) A post-2015 sharp decline in average fitted rent values.
- Potential causes for trends:
  1) Pre-2015 rise could relate to inflation, market demand, or changes in building age, room number, and family size.
  2) The decline after 2015 might reflect economic events, policy changes, or factors outside the model's scope.












