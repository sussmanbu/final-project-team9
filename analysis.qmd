---
title: Analysis
description: Here we provide a detailed analysis using more sophisticated statistics techniques.
toc: true
draft: false
---
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyr)
library(broom)
library(dplyr)
library(here)
library(gt)
library(purrr)
data_path <- here("dataset", "data_twenty_clean.csv")
data_path1 <- here("dataset", "latest_clean.csv")
library(readr)
data_twenty <- read_csv(data_path,show_col_types = FALSE) 
data_2022 <- read_csv(data_path1,show_col_types = FALSE) 
library(ggplot2)
library(knitr)
library(lme4)
library(broom.mixed)
```

# The question we want to address 

- The primary focus of this research is to explore the relationship between an individual's total income and their rental expenditures.
  - The analysis aims to determine how rental spending adjusts in response to changes in income levels.
  - Both linear and nonlinear models are employed to elucidate the connection between these variables.
  - Additionally, the study considers racial differences, examining how the coefficients vary among different racial groups.
  - A time series regression model is utilized to account for temporal variations in this relationship.
  
  
# Models and Inferences (First dataset)
# Outline
1. Simple Linear Regression Model (Based on 2022 Data)
2. Multiple Linear Regression Model (Based on 2022 Data)
3. Log-Log Regression Model (Utilizing the 2022 Dataset)
4. Log-Log Regression Model with interaction terms (Utilizing the 2022 Dataset)


## 1. Simple Linear Regression Model (Based on 2022 Data)
### Model Overview:
- This model explores the relationship between the predictor (income) and the response (rent), providing insights into their potential correlation. Detailed analysis and visualizations are discussed in Class Blog 4.

### Model Findings:
```{r echo=FALSE, message=FALSE, warning=FALSE}
lm_model <- lm(RENTGRS ~ INCTOT, data = data_2022)
tidy_lm <- tidy(lm_model)
kable(tidy_lm, format = "pipe")
```
- The model suggests that an increase of $1,000 in income is associated with an average increase of approximately 5.3213 units in the rent variable.

### Statistical Significance:
```{r echo=FALSE, message=FALSE, warning=FALSE}
glance_lm <- glance(lm_model)
kable(glance_lm, format = "pipe")
```
- The coefficients, including the primary predictor and the intercept, have shown statistical significance, indicating reliable estimations.

### Model Discussion:
- Although this preliminary model sheds light on the relationship between income and rent, further analysis should include additional variables to enhance understanding and accuracy.


## 2. Multiple Linear Regression Model (Based on 2022 Data)
### Model Overview:
- This model enhances the simple linear regression by incorporating additional confounding variables to refine our analysis.
- For more details, refer to Class Blog 4.
- This expanded model builds upon the initial simple linear regression framework.

### Variable Selection:
- A correlation matrix was used to identify control variables and to detect potential multi-collinearity issues.

```{r echo=FALSE, message=FALSE, warning=FALSE}
data_2022$KITCHEN <- as.factor(data_2022$KITCHEN)
data_2022$MARST <- as.factor(data_2022$MARST)
data_2022$RACE <- as.factor(data_2022$RACE)
data_2022$EMPSTAT <- as.factor(data_2022$EMPSTAT)
data_2022$REGION_CLASSIFIED <- as.factor(data_2022$REGION_CLASSIFIED)
cor_matrix <- cor(data_2022[, c("INCTOT", "ROOMS", "NFAMS", "AGE", "FTOTINC", "RENTGRS")])
kable(cor_matrix, format = "pipe")
```

- After fitting the multiple linear regression (MLR) model, 'Kitchen' was removed due to its statistical insignificance, indicated by a high p-value. 'Employment Status', although not as critical, also showed a non-significant p-value and is suspected to interact with variables like 'Income' or 'FTOTINC'. This interaction will be explored further.
- A review of multicollinearity prompted the removal of 'FTOTINC' to prevent model overfitting.

```{r echo=FALSE, message=FALSE, warning=FALSE}
mlr_model <- lm(RENTGRS ~ INCTOT + KITCHEN + ROOMS + NFAMS + AGE + MARST + RACE + EMPSTAT + FTOTINC + REGION_CLASSIFIED, data = data_2022)
library(car)
vif_values <- vif(mlr_model)
kable(vif_values)
```
- The selection and validation of control variables were systematically conducted.

### Inference:
```{r echo=FALSE, message=FALSE, warning=FALSE}
mlr_model <- lm(RENTGRS ~ INCTOT + ROOMS + NFAMS + AGE + MARST + RACE + EMPSTAT  +  REGION_CLASSIFIED, data = data_2022)
glance_mlr <- glance(mlr_model)
kable(glance_mlr, format = "pipe")
```
### Inference:
```{r}
mlr_model <- lm(RENTGRS ~ INCTOT + ROOMS + NFAMS + AGE + MARST + RACE + EMPSTAT + REGION_CLASSIFIED, data = data_2022)
tidy_mlr <- tidy(mlr_model)
kable(tidy_mlr, format = "pipe")
```
- The analysis reveals that a unit increase in total income (INCTOT) is associated with an average increase of 0.0005482 in gross rent (RENTGRS), assuming other variables are constant.

### Statistical Performance:
- The R-squared value of 0.28 indicates that approximately 28% of the variance in the dependent variable (gross rent) is explained by the model, which is a considerable improvement compared to the simple linear regression.
- The adjusted R-squared value of 0.2807292 closely mirrors the R-squared value, suggesting that the additional predictors are effectively contributing valuable information.
- A F-statistic value of 98.57 and a p-value of 0 confirm the statistical significance of the model, suggesting that the regression results are highly unlikely to occur by chance.

### Discussion of the Model:
```{r}
# Fit the model
residuals <- resid(mlr_model)
fitted_values <- fitted(mlr_model)

plot(fitted_values, residuals,
     xlab = "Fitted Values",
     ylab = "Residuals",
     main = "Residual Plot of mlr_model",
     pch = 20)

abline(h = 0, col = "red")
```
- The residual plot shows signs of heteroskedasticity, as the spread of residuals increases with the fitted values. The presence of patterns in the residuals suggests a non-linear relationship between predictors and the response, indicating potential violations of linear model assumptions.
- These issues could be attributed to large values and skewness in the data variables, leading us to consider alternative models, such as a log-log transformation to address these discrepancies.


  
  
  
## 3. Log-Log Regression Model (Utilizing the 2022 Dataset)
### Explanation of the Model: 
 -- Detail in class blog 4
  - Both the predictor and response variables underwent log transformation as their distributions are extremely right skewed (talked in data page)
  - Outliers were identified and removed from the analysis (also talked in data page, showed the density plot)
  - Fit the cleaned variables and do the model again.
  
## Inference:
- We accept this conclusion main conclusion we got from the model is The coefficient (elasticity) of 0.1334 means that a 10% increase in total income (INCTOT) is associated with an average 13.34% increase in rent gross (RENTGRS), given that other variables in the model are held constant.

### Statistical Performance:
- All variables demonstrated statistical significance except one subgroup of marital status and one subgroup of employment status.
```{r echo=FALSE, message=FALSE, warning=FALSE}
log_model_2022 <- lm(log_RENTGRS ~ log_INCTOT  + ROOMS + NFAMS + AGE + MARST + RACE + EMPSTAT + REGION_CLASSIFIED, data = data_2022)
glance_log_model_2022 <- glance(log_model_2022)
kable(glance_log_model_2022)
```

### Discussion of the model:
  - The residual plot suggested an acceptable fit.
```{r echo=FALSE, message=FALSE, warning=FALSE}
residuals_2022 <- resid(log_model_2022)
fitted_values_2022 <- fitted(log_model_2022)

plot(fitted_values_2022, residuals_2022, 
     xlab = "Fitted Values", ylab = "Residuals",
     main = "Residual Plot", pch = 20)
abline(h = 0, col = "red") 
```
- The residual histogram. 
- Four assumptions of linear regression. -- potential non-linearity 


## 4. Log-Log Regression Model with interaction terms (Utilizing the 2022 Dataset)
### Explanation of the Model: 
-  Detail in class blog 4
- good fit in section3 but consider nonlinearity

### variable selction
- Add interaction term EMPSTAT*FTOTINC; as indicated the potential interaction between them,
  confirm to add the interaction term, After incorporating the interaction terms, the p-value for "EMPSTATUnemployed:FTOTINC" is slightly above the conventional alpha threshold of 0.05, suggesting marginal statistical significance. 
```{r echo=FALSE, message=FALSE, warning=FALSE}
data_2022$FTOTINC = data_2022$FTOTINC-data_2022$INCTOT
log_model_2022 <- lm(log_RENTGRS ~ log_INCTOT  + ROOMS + NFAMS + AGE + MARST + RACE +EMPSTAT*FTOTINC +REGION_CLASSIFIED, data = data_2022)
tidy_log_model_2022 <- tidy(log_model_2022)
kable(tidy_log_model_2022)
```
  - The addition of this interaction term does not adversely affect the performance of the other variables, as assessed by their respective p-values.
  
### Inference 
-The conclusion is the coefficient change from shifting from 0.1334 to 0.1715199, indicating a potential moderating effect of employment status on the relationship between total family income and gross rent.It means that given a 10% increase in total income (INCTOT) is associated with an average 17.15% increase in rent gross (RENTGRS), given that other variables in the model are held constant.

### Statistical Performance:
- All variables demonstrated statistical significance except one subgroup of marital status and one subgroup of employment status.
  
### Discussion of the model:
-The residual plot suggested an acceptable fit.
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Calculate residuals and fitted values
residuals_2022 <- resid(log_model_2022)
fitted_values_2022 <- fitted(log_model_2022)

# Create a residual plot
plot(fitted_values_2022, residuals_2022, 
     xlab = "Fitted Values", ylab = "Residuals",
     main = "Residual Plot", pch = 20)
abline(h = 0, col = "red") 
```
  
  
  
  
  
  
  
  
  
  
# Models and Inferences (Second dataset)  
- **Log-Log Regression Model** (Utilizing the 2000-2022 Dataset) -- Detail in class blog 5
  - Using the accepted model above to fit the dataset of each year 
  - All coefficients show to be statistically significant 
  - Plot the residual plot & comfirmed it is falling within an acceptable range.
  - Compare the coefficients change for each year, plot diagram see the trend 
  
- Log-Log Regression Model **by Race** (2022 Dataset) — Detail in class blog 6
  - The analysis stratified the data by race, applying the aforementioned Log-Log regression approach.
  - It provided detailed coefficients for each racial category, examining the influence on the rent-income relationship.
  - The statistical significance of all coefficients was verified, with residual plots falling within an acceptable range.
  

- Longitudinal Log-Log Regression Model **by Race** (2000-2022 Dataset) — Detail in class blog 6
  - This model extended the 2022 dataset analysis to explore how the rent-income relationship for each racial group has evolved from 2000 to 2022.
  - Trends over time for each race were charted to illustrate these dynamics.
  - Similar to the 2022 model, the coefficients were found to be statistically significant and the residual plots falling within an acceptable range.
  
- Time series model (using 2000-2022 dataset) -- Detail in class blog 7

































  


------------------------------------------------------------------------

## Rubric: On this page

You will

-   Introduce what motivates your Data Analysis (DA)
    -   Which variables and relationships are you most interested in?
    -   What questions are you interested in answering?
    -   Provide context for the rest of the page. This will include figures/tables that illustrate aspects of the data of your question.
-   Modeling and Inference
    -   The page will include some kind of formal statistical model. This could be a linear regression, logistic regression, or another modeling framework.
    -   Explain the ideas and techniques you used to choose the predictors for your model. (Think about including interaction terms and other transformations of your variables.)
    -   Describe the results of your modelling and make sure to give a sense of the uncertainty in your estimates and conclusions.
-   Explain the flaws and limitations of your analysis
    -   Are there some assumptions that you needed to make that might not hold? Is there other data that would help to answer your questions?
-   Clarity Figures
    -   Are your figures/tables/results easy to read, informative, without problems like overplotting, hard-to-read labels, etc?
    -   Each figure should provide a key insight. Too many figures or other data summaries can detract from this. (While not a hard limit, around 5 total figures is probably a good target.)
    -   Default `lm` output and plots are typically not acceptable.
-   Clarity of Explanations
    -   How well do you explain each figure/result?
    -   Do you provide interpretations that suggest further analysis or explanations for observed phenomenon?
-   Organization and cleanliness.
    -   Make sure to remove excessive warnings, hide most or all code, organize with sections or multiple pages, use bullets, etc.
    -   This page should be self-contained, i.e. provide a description of the relevant data.
